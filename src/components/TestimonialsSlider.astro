---
import TestimonialCard from './TestimonialCard.astro';

const testimonials = [
  {
    img:"./lars_elby.webp",
    title: "Iværksætte vil give storbyens elbilsister et billigere alternativ til kantstensladere",
    source: "INGENIØREN",
  },
  {
    img:"./lars_elby.webp",
    title: "Elby's innovation could serve as a blueprint for rapid and cost-effective expansion",
    source: "TREND WATCHING",
  },
  {
    img:"./lars_elby.webp",
    title: "Det ligner en fremragende løsning. Less is more",
    name: "Rasmus Helweg",
    role: "Elby-værk. og energirådgiver m.m.",
  },
  {
    img:"./lars_elby.webp",
    title: "Lyder spændende. Vi kan ikke blive ved med at fylde byen op med udstyr",
    name: "Lone Lærkilde",
    role: "Urbanteknolog, Roskilde Kommune",
  }
];
---
<div class="relative w-full" client:load>
  <div id="slider" class="flex overflow-x-auto gap-4 px-4 py-6 scroll-smooth snap-x snap-mandatory">
    {testimonials.map((item, index) => (
      <div class="snap-start shrink-0 w-[80%] sm:w-[300px]">
        <TestimonialCard {...item} />
      </div>
    ))}
  </div>

  <!-- Dots navigation -->
  <div id="dots" class="flex justify-center mt-4 gap-2">
    {testimonials.map((_, index) => (
      <span
        class="dot w-3 h-3 rounded-full bg-primary-600 transition duration-300"
        data-index={index}
      ></span>
    ))}
  </div>

  <script type="module">
    const slider = document.getElementById("slider");
    const dots = document.querySelectorAll(".dot");
    let index = 0;

    const scrollToIndex = (i) => {
      const card = slider.children[i];
      if (card) {
        slider.scrollTo({
          left: card.offsetLeft,
          behavior: 'smooth',
        });
        setActiveDot(i);
      }
    };

    const setActiveDot = (i) => {
      dots.forEach(dot => dot.classList.remove("bg-acc_yel-500"));
      if (dots[i]) dots[i].classList.add("bg-acc_yel-500");
    };

    dots.forEach(dot => {
      dot.addEventListener("click", () => {
        const i = Number(dot.dataset.index);
        index = i;
        scrollToIndex(i);
      });
    });

    const autoScroll = () => {
      index = (index + 1) % dots.length;
      scrollToIndex(index);
    };

    setActiveDot(0);
    const interval = setInterval(autoScroll, 5000); // Auto-scroll every 2s
  </script>
</div>
