<div class="w-full mx-auto py-sm mt-10" id="leadflow">
    <h2>Se hvilken løsning fra Elby, der passer til dig</h2>
  <div id="app" class="relative min-h-[250px] md:min-h-[300px] pb-6">
  </div>

  <!-- Progress bar (bottom) -->
  <div id="progressWrapper" class="flex justify-center max-w-[600px] mx-auto">
    <div class="h-2 bg-gray-200 rounded overflow-hidden w-full">
      <div id="progressBar" class="h-2 bg-acc_yel-500 transition-all duration-300 ease-in-out" style="width: 0%"></div>
    </div>
  </div>
</div>

<script type="module">
  import { animate } from "https://cdn.skypack.dev/motion";

  const questions = [
    {
      question: "Hvilken type lejlighed bor du i?",
      options: [
        { label: "Leje", image: "/images/leje.png" },
        { label: "Andel", image: "/images/andel.png" },
        { label: "Ejer", image: "/images/ejer.png" }
      ]
    },
    {
      question: "Hvordan parkerer man ved jeres opgang?",
      options: ["Parkering på gaden", "Privatparkeringsplads eller p kælder", "Ingen parkeringspladser"]
    },
    {
      question: "Er der cykelsti mellem fortov og gade?",
      options: ["Ingen cykelsti", "Cykelsti", "Ved ikke"]
    },
    {
      question: "Hvor mange fortovsfliser er der mellem bygningsmur og parkering?",
      options: ["1 flise", "2 fliser", "3 eller flere fliser"]
    },
    {
      question: "Hvad er din rolle i opgangen?",
      options: ["Beboer", "Bestyrelsesmedlem", "Administrator eller bygningsejer"]
    }
  ];

  const disqualifyingAnswers = [
    "Privatparkeringsplads eller p kælder",
    "Ingen parkeringspladser",
    "Cykelsti",
    "3 eller flere fliser"
  ];

  let step = 0;
  const answers = [];
  const app = document.getElementById("app");
  const progressBar = document.getElementById("progressBar");
  const progressWrapper = document.getElementById("progressWrapper");

  function updateProgress() {
    const totalSteps = questions.length;
    if (step === 0 || step >= totalSteps) {
      progressWrapper.style.display = "none";
    } else {
      progressWrapper.style.display = "block";
    }
    const percentage = (step / totalSteps) * 100;
    progressBar.style.width = `${percentage}%`;
  }

  function animateIn() {
    animate("#app > *", { opacity: [0, 1], y: [20, 0] }, { duration: 0.4 });
  }

  function render() {
    app.innerHTML = "";
    updateProgress();

    if (step < questions.length) {
      const q = questions[step];
      const container = document.createElement("div");
      container.className = "max-w-[600px] mx-auto px-4 sm:px-6";

      if (step === 0) {
        container.innerHTML = `
          <h2 class="text-lg font-body font-semibold mb-4">${q.question}</h2>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            ${q.options.map(opt => `
              <button class="flex flex-col items-center shadow bg-acc_yel-50 hover:bg-acc_yel-500 p-4 rounded transition w-full" data-answer="${opt.label}">
                <img src="${opt.image}" alt="${opt.label}" class="w-16 h-16 mb-2 object-contain" />
                <span>${opt.label}</span>
              </button>
            `).join('')}
          </div>
        `;
      } else {
        container.innerHTML = `
          <h2 class="text-lg font-body font-semibold mb-4">${q.question}</h2>
          <div class="space-y-2">
            ${q.options.map(opt => `
              <button class="w-full text-left border-black shadow bg-acc_yel-50 hover:bg-acc_yel-500 px-4 py-2 rounded transition" data-answer="${opt}">
                ${opt}
              </button>
            `).join('')}
          </div>
          ${step > 0 ? `<button id="backBtn" class="mt-6 text-blue-600">Tilbage</button>` : ''}
        `;
      }

      app.appendChild(container);
      container.querySelectorAll("[data-answer]").forEach(btn => {
        btn.addEventListener("click", () => {
          answers[step] = btn.dataset.answer;
          step++;
          render();
        });
      });
      const backBtn = container.querySelector("#backBtn");
      if (backBtn) backBtn.addEventListener("click", () => {
        step--;
        render();
      });
    }
    else if (step === questions.length) {
      // Her vises to forskellige slutskærme med hver sit headline, tekst og billede
      const hasDisqualifying = answers.some(a => disqualifyingAnswers.includes(a));
      const container = document.createElement("div");
      container.className = "max-w-[600px] mx-auto px-4 sm:px-6";

      if (hasDisqualifying) {
        // Slutskærm: Vi har brug for flere oplysninger
        container.innerHTML = `
          <h2 class="text-2xl font-bold mb-4">Vi har brug for flere oplysninger</h2>
          <p class="text-gray-700 mb-4">Vi mangler lidt information for at kunne give dig den bedste løsning. Hjælp os ved at besvare et par ekstra spørgsmål.</p>
          <img src="/images/extra-info.png" alt="Ekstra oplysninger" class="w-full h-auto mb-6 rounded" />
        `;
      } else {
        // Slutskærm: Du er klar til Elby!
        container.innerHTML = `
          <h2 class="text-2xl font-bold mb-4">Du er klar til Elby!</h2>
          <p class="text-gray-700 mb-4">Fantastisk! Send os dine kontaktoplysninger. Så fortæller vi dig om, hvordan I hurtigt kommer i gang. Og bare rolig, det er helt uforpligtende.</p>
          <img src="/images/ready-elby.png" alt="Klar til Elby" class="w-full h-auto mb-6 rounded" />
        `;
      }

      // Fælles knapper
      container.innerHTML += `
        <button id="continueBtn" class="w-full bg-acc_yel-500 text-black py-2 rounded mb-2">Indtast dine kontaktoplysninger</button>
        <button id="backBtn" class="text-blue-600">Tilbage</button>
      `;

      app.appendChild(container);
      document.getElementById("continueBtn").addEventListener("click", () => {
        step++;
        render();
      });
      document.getElementById("backBtn").addEventListener("click", () => {
        step--;
        render();
      });
    }
    else if (step === questions.length + 1) {
      const form = document.createElement("div");
      form.className = "max-w-[600px] mx-auto px-4 sm:px-6";
      form.innerHTML = `
        <h2 class="text-lg font-body font-semibold mb-4">Indtast dine kontaktoplysninger</h2>
        <form class="space-y-4">
          <input type="text" placeholder="Navn" class="w-full border p-2 rounded" required />
          <input type="email" placeholder="Email" class="w-full border p-2 rounded" required />
          <input type="tel" placeholder="Telefonnummer" class="w-full border p-2 rounded" />
          <textarea placeholder="Evt. kommentar" class="w-full border p-2 rounded"></textarea>
          <button type="submit" class="bg-acc_yel-500 text-black px-4 py-2 rounded w-full">Send</button>
        </form>
        <button id="backBtn" class="mt-4 text-blue-600">Tilbage</button>
      `;
      app.appendChild(form);
      form.querySelector("#backBtn").addEventListener("click", () => {
        step--;
        render();
      });
      form.querySelector("form").addEventListener("submit", e => {
        e.preventDefault();
        step++;
        render();
      });
    }
    else {
      const thankYou = document.createElement("div");
      thankYou.className = "max-w-[600px] mx-auto px-4 sm:px-6 flex flex-col items-center justify-center text-center";
      thankYou.innerHTML = `
        <img src="/images/thumbsup.png" alt="Tak" class="w-24 h-24 mb-4 object-contain" />
        <h2 class="text-2xl font-semibold mb-2 text-acc_yel-500">Tak for din henvendelse!</h2>
        <p class="text-gray-700">Vi vender tilbage hurtigst muligt.</p>
      `;
      app.appendChild(thankYou);
    }

    animateIn();
  }

  render();
</script>