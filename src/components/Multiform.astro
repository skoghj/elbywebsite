---
import Button from "./Button.astro";
---

<div x-data="multiStepForm()" class="flex flex-col md:flex-row overflow-hidden w-full">
  <!-- Right formular -->
  <div class="w-full p-2xl">
    <h2 class="font-title font-bold mb-xs">Få Elby i din opgang</h2>
    <p class="text-body-md mb-l">
      Vi har behov for lidt mere information, end hvad du er vant til,<br />
      men det tager kun 2 minutter!
    </p>

    <!-- PROCESBAR -->
    <div class="relative mb-l">
      <div class="absolute inset-x-0 top-0 flex justify-between">
        <template x-for="(_, i) in labels" :key="i">
          <div class="w-4 h-4 rounded-full z-10" :class="step > i ? 'bg-acc_yel-500' : 'bg-neu_db-300'"></div>
        </template>
      </div>
      <div class="absolute inset-x-0 top-2 h-0.5 bg-neu_db-300 rounded-full"></div>
      <div class="absolute inset-x-0 top-2 h-0.5 bg-acc_yel-500 rounded-full" :style="`width: ${(step-1)/(labels.length-1)*100}%`"></div>
      <div class="pt-6 flex justify-between text-body-sm text-sec_bl-950">
        <template x-for="lbl in labels" :key="lbl">
          <div x-text="lbl"></div>
        </template>
      </div>
    </div>

    <!-- FORM -->
    <form @submit.prevent="next()" class="space-y-m">
      <!-- STEP 1 -->
      <div x-show="step === 1" x-cloak class="space-y-m">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-m">
          <div>
            <label class="block mb-1 font-semibold">Fornavn <span class="text-acc_yel-700">*</span></label>
            <input type="text" x-model="form.firstName" placeholder="Mads" class="w-full p-xxs rounded-xs border neu_db-300 shadow-sm" :class="errors.firstName ? 'border-red-500' : ''" />
            <p x-show="errors.firstName" class="mt-1 text-xs text-red-500" x-text="errors.firstName"></p>
          </div>
          <div>
            <label class="block mb-1 font-semibold">Efternavn <span class="text-acc_yel-700">*</span></label>
            <input type="text" x-model="form.lastName" placeholder="Hansen" class="w-full p-xxs rounded-xs border neu_db-300 shadow-sm" :class="errors.lastName ? 'border-red-500' : ''" />
            <p x-show="errors.lastName" class="mt-1 text-xs text-red-500" x-text="errors.lastName"></p>
          </div>
          <div>
            <label class="block mb-1 font-semibold">E-mail <span class="text-acc_yel-700">*</span></label>
            <input type="email" x-model="form.email" placeholder="mads.hansen@gmail.com" class="w-full p-xxs rounded-xs border neu_db-300 shadow-sm" :class="errors.email ? 'border-red-500' : ''" />
            <p x-show="errors.email" class="mt-1 text-xs text-red-500" x-text="errors.email"></p>
          </div>
          <div>
            <label class="block mb-1 font-semibold">Telefon (valgfri)</label>
            <input type="tel" x-model="form.phone" placeholder="+45 12 34 56 78" class="w-full p-xxs rounded-xs border neu_db-300 shadow-sm" :class="errors.phone ? 'border-red-500' : ''" />
            <p x-show="errors.phone" class="mt-1 text-xs text-red-500" x-text="errors.phone"></p>
          </div>
        </div>
        <div>
          <label class="block mb-2 font-semibold">Din rolle i bygningen? <span class="text-acc_yel-700">*</span></label>
          <template x-for="role in roles" :key="role">
            <label class="flex items-center space-x-xs mb-2">
              <div class="relative w-5 h-5 cursor-pointer">
                <input type="radio" :value="role" x-model="form.role" class="peer absolute inset-0 w-full h-full opacity-0" />
                <span class="absolute inset-0 border-2 border-neu_db-300 rounded-full"></span>
                <span class="absolute inset-1 rounded-full bg-acc_yel-700 scale-0 peer-checked:scale-100 transition-transform duration-150"></span>
              </div>
              <span x-text="role"></span>
            </label>
          </template>
          <p x-show="errors.role" class="mt-1 text-xs text-red-500" x-text="errors.role"></p>
        </div>

        <!-- STEP 1 button -->
        <div class="flex justify-start mt-l">
          <Button variant="primary" size="standard" type="submit">Næste</Button>
        </div>
      </div>

      <!-- STEP 2 -->
      <div x-show="step === 2" x-cloak class="space-y-m">
        <div>
          <label class="block mb-1 font-semibold">Bygningens adresse <span class="text-acc_yel-600">*</span></label>
          <input type="text" x-model="form.address" placeholder="Nørrebrogade 45, 2. th., 2200 København N" class="w-full p-xs rounded-xs border neu_db-300 shadow-sm" :class="errors.address ? 'border-red-500' : ''" />
          <p x-show="errors.address" class="mt-1 text-xs text-red-500" x-text="errors.address"></p>
        </div>
        <div>
          <label class="block mb-2 font-semibold">Bygningstype <span class="text-acc_yel-700">*</span></label>
          <template x-for="type in bygningstype" :key="type">
            <label class="flex items-center space-x-xs mb-2">
              <div class="relative w-5 h-5 cursor-pointer">
                <input type="radio" :value="type" x-model="form.type" class="peer absolute inset-0 w-full h-full opacity-0" />
                <span class="absolute inset-0 border-2 border-neu_db-300 rounded-full"></span>
                <span class="absolute inset-1 rounded-full bg-acc_yel-700 scale-0 peer-checked:scale-100 transition-transform duration-150"></span>
              </div>
              <span x-text="type"></span>
            </label>
          </template>
          <p x-show="errors.type" class="mt-1 text-xs text-red-500" x-text="errors.type"></p>
        </div>

        <!-- STEP 2 buttons -->
        <div class="flex gap-m mt-l">
          <Button variant="secondary" size="standard" type="button" @click="back()">Tilbage</Button>
          <Button variant="primary" size="standard" type="submit">Næste</Button>
        </div>
      </div>

      <!-- STEP 3 -->
      <div x-show="step === 3" x-cloak class="mt-l p-l border-4 rounded-lg border-acc_yel-700 text-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-24 mx-auto text-acc_yel-700 pb-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"></path>
        </svg>

        <h2 class="font-title text-2xl mb-xxs">Tak for din henvendelse</h2>
        <p class="text-body-md">Din besked er modtaget, og vi vender tilbage hurtigst muligt.</p>

        <!-- STEP 3 button -->
        <div class="flex justify-center mt-md">
          <Button variant="primary" size="standard" type="button" @click="goHome()">Gå til forside</Button>
        </div>
      </div>
    </form>
  </div>
</div>

<script is:inline>
  window.multiStepForm = function () {
    return {
      step: 1,
      labels: ["Om dig", "Om bygningen", "Indsend"],
      roles: ["Beboer i bygningen", "Bestyrelsesmedlem i bygningen", "Ejer af bygningen", "Administrator af bygningen", "Andet/ønsker ikke at oplyse"],
      bygningstype: ["Ejerforening", "Andelsforening", "Almen bolig", "Lejebolig", "Erhvervslejemål", "Andet/ved ikke"],
      form: {
        firstName: "",
        lastName: "",
        email: "",
        phone: "",
        role: "",
        address: "",
        type: "",
      },
      errors: {},

      next() {
        this.clearErrors();
        if (this.step === 1) {
          if (!this.form.firstName) this.errors.firstName = "Fornavn er påkrævet.";
          if (!this.form.lastName) this.errors.lastName = "Efternavn er påkrævet.";
          if (!this.form.email) this.errors.email = "E-mail er påkrævet.";
          else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.form.email)) this.errors.email = "Ugyldigt e-mail-format.";
          if (this.form.phone && !/^[\d+\s\-]+$/.test(this.form.phone)) this.errors.phone = "Ugyldigt telefonnummer.";
          if (!this.form.role) this.errors.role = "Vælg venligst en rolle.";
        } else if (this.step === 2) {
          if (!this.form.address) this.errors.address = "Adresse er påkrævet.";
          if (!this.form.type) this.errors.type = "Vælg venligst bygningstype.";
        }
        if (Object.keys(this.errors).length === 0) {
          this.step++;
        }
      },

      back() {
        if (this.step > 1) {
          this.step--;
          console.log("Går tilbage til step:", this.step);
        }
      },

      goHome() {
        window.location.href = "/";
      },

      clearErrors() {
        this.errors = {};
      },
    };
  };
</script>
